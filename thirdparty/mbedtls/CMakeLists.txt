#Enforce the highest possible version that the current Ubuntu LTS provides
#by default. We want to be sure to have the ability to attach as many things
#to the target as modern cmake code affords us
cmake_minimum_required(VERSION 3.16 FATAL_ERROR)

set(MBEDTLS_SOURCE_DIR ${GODOT_SOURCE_ROOT_THIRDPARTY_DIR}/mbedtls)
set(MBEDTLS_SOURCE
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ecdh.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/entropy.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/net_sockets.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/blowfish.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/x509.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/asn1.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ctr_drbg.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/version.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/md5.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/sha512.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/havege.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/compat-1.3.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/md_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/xtea.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/entropy_poll.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/timing.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/x509_crt.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pkcs5.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/bn_mul.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/sha256.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/camellia.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/error.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl_cookie.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pkcs12.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/rsa_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/gcm.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/cipher_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ecjpake.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/dhm.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/net.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/config.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/platform_time.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/poly1305.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/md.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/nist_kw.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/rsa.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/certs.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ecdsa.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/cipher.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl_cache.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ecp.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pk_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/padlock.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/aria.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/aes.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/base64.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pkcs11.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/constant_time.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/asn1write.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/chacha20.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/hmac_drbg.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/des.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ccm.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/platform.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/md2.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/memory_buffer_alloc.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/sha1.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/aesni.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/threading.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/check_config.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/chachapoly.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/x509_csr.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl_ticket.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ssl_ciphersuites.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ecp_internal.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/ripemd160.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/debug.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/md4.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pk.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/bignum.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/hkdf.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/arc4.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/oid.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/platform_util.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/pem.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/x509_crl.h
    ${MBEDTLS_SOURCE_DIR}/include/mbedtls/cmac.h
    ${MBEDTLS_SOURCE_DIR}/include/godot_core_mbedtls_config.h
    ${MBEDTLS_SOURCE_DIR}/library/des.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_cli.c
    ${MBEDTLS_SOURCE_DIR}/library/xtea.c
    ${MBEDTLS_SOURCE_DIR}/library/asn1write.c
    ${MBEDTLS_SOURCE_DIR}/library/ccm.c
    ${MBEDTLS_SOURCE_DIR}/library/md4.c
    ${MBEDTLS_SOURCE_DIR}/library/ecdh.c
    ${MBEDTLS_SOURCE_DIR}/library/mps_error.h
    ${MBEDTLS_SOURCE_DIR}/library/platform.c
    ${MBEDTLS_SOURCE_DIR}/library/havege.c
    ${MBEDTLS_SOURCE_DIR}/library/version.c
    ${MBEDTLS_SOURCE_DIR}/library/ecp_curves.c
    ${MBEDTLS_SOURCE_DIR}/library/entropy.c
    ${MBEDTLS_SOURCE_DIR}/library/sha256.c
    ${MBEDTLS_SOURCE_DIR}/library/blowfish.c
    ${MBEDTLS_SOURCE_DIR}/library/base64.c
    ${MBEDTLS_SOURCE_DIR}/library/ecdsa.c
    ${MBEDTLS_SOURCE_DIR}/library/debug.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_cache.c
    ${MBEDTLS_SOURCE_DIR}/library/pkparse.c
    ${MBEDTLS_SOURCE_DIR}/library/pkwrite.c
    ${MBEDTLS_SOURCE_DIR}/library/padlock.c
    ${MBEDTLS_SOURCE_DIR}/library/net_sockets.c
    ${MBEDTLS_SOURCE_DIR}/library/mps_reader.c
    ${MBEDTLS_SOURCE_DIR}/library/aes.c
    ${MBEDTLS_SOURCE_DIR}/library/common.h
    ${MBEDTLS_SOURCE_DIR}/library/hkdf.c
    ${MBEDTLS_SOURCE_DIR}/library/x509_crl.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_srv.c
    ${MBEDTLS_SOURCE_DIR}/library/pkcs12.c
    ${MBEDTLS_SOURCE_DIR}/library/bignum.c
    ${MBEDTLS_SOURCE_DIR}/library/cmac.c
    ${MBEDTLS_SOURCE_DIR}/library/ecp_invasive.h
    ${MBEDTLS_SOURCE_DIR}/library/mps_trace.h
    ${MBEDTLS_SOURCE_DIR}/library/md5.c
    ${MBEDTLS_SOURCE_DIR}/library/pk_wrap.c
    ${MBEDTLS_SOURCE_DIR}/library/x509_crt.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_tls13_keys.h
    ${MBEDTLS_SOURCE_DIR}/library/gcm.c
    ${MBEDTLS_SOURCE_DIR}/library/x509_create.c
    ${MBEDTLS_SOURCE_DIR}/library/pkcs11.c
    ${MBEDTLS_SOURCE_DIR}/library/x509write_csr.c
    ${MBEDTLS_SOURCE_DIR}/library/x509.c
    ${MBEDTLS_SOURCE_DIR}/library/version_features.c
    ${MBEDTLS_SOURCE_DIR}/library/chachapoly.c
    ${MBEDTLS_SOURCE_DIR}/library/mps_common.h
    ${MBEDTLS_SOURCE_DIR}/library/hmac_drbg.c
    ${MBEDTLS_SOURCE_DIR}/library/nist_kw.c
    ${MBEDTLS_SOURCE_DIR}/library/check_crypto_config.h
    ${MBEDTLS_SOURCE_DIR}/library/mps_trace.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_ticket.c
    ${MBEDTLS_SOURCE_DIR}/library/rsa_internal.c
    ${MBEDTLS_SOURCE_DIR}/library/cipher.c
    ${MBEDTLS_SOURCE_DIR}/library/error.c
    ${MBEDTLS_SOURCE_DIR}/library/pkcs5.c
    ${MBEDTLS_SOURCE_DIR}/library/rsa.c
    ${MBEDTLS_SOURCE_DIR}/library/platform_util.c
    ${MBEDTLS_SOURCE_DIR}/library/pk.c
    ${MBEDTLS_SOURCE_DIR}/library/timing.c
    ${MBEDTLS_SOURCE_DIR}/library/aesni.c
    ${MBEDTLS_SOURCE_DIR}/library/mps_reader.h
    ${MBEDTLS_SOURCE_DIR}/library/sha512.c
    ${MBEDTLS_SOURCE_DIR}/library/ripemd160.c
    ${MBEDTLS_SOURCE_DIR}/library/asn1parse.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_tls13_keys.c
    ${MBEDTLS_SOURCE_DIR}/library/memory_buffer_alloc.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_msg.c
    ${MBEDTLS_SOURCE_DIR}/library/camellia.c
    ${MBEDTLS_SOURCE_DIR}/library/aria.c
    ${MBEDTLS_SOURCE_DIR}/library/cipher_wrap.c
    ${MBEDTLS_SOURCE_DIR}/library/md2.c
    ${MBEDTLS_SOURCE_DIR}/library/godot_core_mbedtls_platform.c
    ${MBEDTLS_SOURCE_DIR}/library/dhm.c
    ${MBEDTLS_SOURCE_DIR}/library/ecp.c
    ${MBEDTLS_SOURCE_DIR}/library/x509_csr.c
    ${MBEDTLS_SOURCE_DIR}/library/entropy_poll.c
    ${MBEDTLS_SOURCE_DIR}/library/sha1.c
    ${MBEDTLS_SOURCE_DIR}/library/constant_time_internal.h
    ${MBEDTLS_SOURCE_DIR}/library/ssl_tls.c
    ${MBEDTLS_SOURCE_DIR}/library/pem.c
    ${MBEDTLS_SOURCE_DIR}/library/threading.c
    ${MBEDTLS_SOURCE_DIR}/library/ecjpake.c
    ${MBEDTLS_SOURCE_DIR}/library/md.c
    ${MBEDTLS_SOURCE_DIR}/library/poly1305.c
    ${MBEDTLS_SOURCE_DIR}/library/constant_time.c
    ${MBEDTLS_SOURCE_DIR}/library/chacha20.c
    ${MBEDTLS_SOURCE_DIR}/library/ctr_drbg.c
    ${MBEDTLS_SOURCE_DIR}/library/x509write_crt.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_cookie.c
    ${MBEDTLS_SOURCE_DIR}/library/oid.c
    ${MBEDTLS_SOURCE_DIR}/library/ssl_ciphersuites.c
    ${MBEDTLS_SOURCE_DIR}/library/constant_time_invasive.h
    ${MBEDTLS_SOURCE_DIR}/library/certs.c
    ${MBEDTLS_SOURCE_DIR}/library/arc4.c
    )
godot_add_library(mbedtls thirdparty STATIC ${MBEDTLS_SOURCE})
target_include_directories(mbedtls PUBLIC ${MBEDTLS_SOURCE_DIR}/include)
if(CMAKE_SYSTEM_NAME STREQUAL "Windows")
    target_link_libraries(mbedtls bcrypt)
endif()
